# Arduino 接線指南與數據驗證

## 📋 硬體需求清單

### 主控板
- **Arduino Nano 33 BLE Sense Rev2** (必需)
  - 內建 BMI270 + BMM150 IMU 傳感器
  - 內建藍牙低功耗 (BLE) 模組
  - 內建 PDM 麥克風 (語音分析功能)

### 外部傳感器
- **5個電位器** (10kΩ 線性電位器，可選)
- **EMG 肌電傳感器** (可選)
- **舵機** (SG90 或類似，用於阻力訓練)
- **按鈕** (用於手動控制)

---

## 🔌 詳細接線圖

### 電位器連接 (手指彎曲檢測) - 左手配置
```
電位器接線方式 (左手邏輯)：
┌─────────────────┬──────────────┬─────────────────┬─────────────────┐
│   電位器引腳    │ Arduino 引腳 │      說明       │   數據映射      │
├─────────────────┼──────────────┼─────────────────┼─────────────────┤
│ 拇指電位器中心  │     A4       │ PIN_THUMB       │ finger1 (左手)  │
│ 食指電位器中心  │     A3       │ PIN_INDEX       │ finger2 (左手)  │
│ 中指電位器中心  │     A2       │ PIN_MIDDLE      │ finger3 (左手)  │
│ 無名指電位器中心│     A1       │ PIN_RING        │ finger4 (左手)  │
│ 小指電位器中心  │     A0       │ PIN_PINKY       │ finger5 (左手)  │
│ 所有電位器 VCC  │     3.3V     │ 電源正極        │                 │
│ 所有電位器 GND  │     GND      │ 電源負極        │                 │
└─────────────────┴──────────────┴─────────────────┴─────────────────┘

檢測電路：
- 電位器檢測引腳 → D2 (PIN_POT_DETECT)
- 當電位器連接時，D2 讀取為 LOW
- 當電位器未連接時，D2 讀取為 HIGH (內建上拉)
```

### EMG 傳感器連接 (肌電信號檢測)
```
EMG 傳感器接線：
┌─────────────────┬──────────────┬─────────────────┐
│   EMG 引腳      │ Arduino 引腳 │      說明       │
├─────────────────┼──────────────┼─────────────────┤
│ EMG 信號輸出    │     A5       │ PIN_EMG         │
│ EMG VCC         │     3.3V     │ 電源正極        │
│ EMG GND         │     GND      │ 電源負極        │
│ EMG 檢測        │     D3       │ PIN_EMG_DETECT  │
└─────────────────┴──────────────┴─────────────────┘

檢測邏輯：
- 當 EMG 連接時，D3 讀取為 LOW
- 當 EMG 未連接時，D3 讀取為 HIGH，使用模擬數據
```

### 舵機與控制元件
```
其他元件接線：
┌─────────────────┬──────────────┬─────────────────┐
│     元件        │ Arduino 引腳 │      說明       │
├─────────────────┼──────────────┼─────────────────┤
│ 舵機信號線      │     D9       │ PIN_SERVO       │
│ 舵機紅線 (VCC)  │     5V       │ 電源正極        │
│ 舵機棕線 (GND)  │     GND      │ 電源負極        │
│ 按鈕一端        │     D4       │ PIN_BUTTON      │
│ 按鈕另一端      │     GND      │ 電源負極        │
│ 狀態 LED        │ LED_BUILTIN  │ 內建 LED        │
└─────────────────┴──────────────┴─────────────────┘
```

### 完整接線示意圖
```
Arduino Nano 33 BLE Sense Rev2
    ┌─────────────────────────┐
    │  ┌─────┐ ┌─────┐ ┌─────┐│
    │  │ IMU │ │ BLE │ │ MIC ││  ← 內建傳感器
    │  └─────┘ └─────┘ └─────┘│
    ├─────────────────────────┤
A0  │○ ← 小指電位器            │
A1  │○ ← 無名指電位器          │
A2  │○ ← 中指電位器            │
A3  │○ ← 食指電位器            │
A4  │○ ← 拇指電位器            │
A5  │○ ← EMG 傳感器            │
    │                         │
D2  │○ ← 電位器檢測引腳        │
D3  │○ ← EMG 檢測引腳          │
D4  │○ ← 用戶按鈕              │
D9  │○ ← 舵機控制              │
    │                         │
3V3 │○ ← 傳感器電源 (+)        │
GND │○ ← 傳感器電源 (-)        │
5V  │○ ← 舵機電源 (+)          │
    └─────────────────────────┘
```

---

## 📊 數據格式與驗證

### Arduino 輸出的數據格式 (左手邏輯)
```
標準數據格式 (每100ms發送一次):
DATA,thumb,index,middle,ring,pinky,emg,accel_x,accel_y,accel_z,gyro_x,gyro_y,gyro_z,mag_x,mag_y,mag_z

範例數據：
DATA,512,678,345,789,234,456,0.12,-0.34,0.98,1.23,-2.45,0.67,12.3,-45.6,78.9

數據說明 (左手邏輯)：
- finger1 (thumb): 拇指電位器數值 (0-1023)
- finger2 (index): 食指電位器數值 (0-1023)
- finger3 (middle): 中指電位器數值 (0-1023)
- finger4 (ring): 無名指電位器數值 (0-1023)
- finger5 (pinky): 小指電位器數值 (0-1023)
- emg: EMG 信號強度 (0-1023)
- accel_x,y,z: 加速度計 (g, 範圍 ±4g)
- gyro_x,y,z: 陀螺儀 (°/s, 範圍 ±2000°/s)
- mag_x,y,z: 磁力計 (μT, 範圍 ±1300μT)
```

### 真實數據 vs 模擬數據識別

#### 🔍 如何判斷數據是否為真實數據

**1. 電位器數據檢查**
```cpp
// Arduino 代碼中的檢測邏輯
if (digitalRead(PIN_POT_DETECT) == LOW) {
    // 真實電位器已連接
    finger_values[0] = analogRead(PIN_THUMB);
    finger_values[1] = analogRead(PIN_INDEX);
    // ... 其他手指
} else {
    // 使用模擬數據
    finger_values[0] = 512 + random(-100, 100);
    // ... 模擬其他手指數據
}
```

**2. EMG 數據檢查**
```cpp
if (digitalRead(PIN_EMG_DETECT) == LOW) {
    // 真實 EMG 傳感器已連接
    emg_value = analogRead(PIN_EMG);
} else {
    // 使用模擬 EMG 數據
    emg_value = 431 + random(-50, 50);
}
```

**3. 數據特徵識別**

| 數據類型 | 真實數據特徵 | 模擬數據特徵 |
|----------|-------------|-------------|
| **手指電位器** | 數值變化平滑，有人體動作特徵 | 數值跳躍較大，隨機性明顯 |
| **EMG 信號** | 有肌肉收縮的波形特徵 | 固定基準值 ± 隨機噪音 |
| **IMU 數據** | 始終為真實數據 (內建傳感器) | 不適用 |

**4. 串口監視器檢查方法**
```
打開 Arduino IDE 串口監視器 (9600 波特率)，觀察輸出：

真實數據範例：
SYSTEM: 電位器檢測: 已連接
SYSTEM: EMG檢測: 已連接
DATA,523,678,445,789,334,567,0.12,-0.34,0.98,1.23,-2.45,0.67,12.3,-45.6,78.9

模擬數據範例：
SYSTEM: 電位器檢測: 未連接 (使用模擬數據)
SYSTEM: EMG檢測: 未連接 (使用模擬數據)
DATA,512,512,512,512,512,431,0.12,-0.34,0.98,1.23,-2.45,0.67,12.3,-45.6,78.9
```

---

## 🌐 網頁端數據驗證

### 在瀏覽器控制台檢查數據來源
```javascript
// 打開瀏覽器開發者工具 (F12)，在控制台中查看：

// 1. 查看原始數據
console.log('收到原始數據:', dataString.trim());

// 2. 查看解析後的數據
console.log('解析到數據:', {
    fingers: [523, 678, 445, 789, 334],
    emg: 567,
    accel: {x: 0.12, y: -0.34, z: 0.98},
    gyro: {x: 1.23, y: -2.45, z: 0.67},
    mag: {x: 12.3, y: -45.6, z: 78.9}
});

// 3. 檢查數據更新頻率
// 真實數據：每100ms更新一次，數值平滑變化
// 模擬數據：數值可能有明顯跳躍
```

### 數據真實性指標
```
✅ 真實數據指標：
- 手指數值隨手部動作平滑變化
- EMG 數值隨肌肉收縮有明顯變化
- 數據更新穩定 (10Hz)
- 串口顯示 "已連接" 狀態

❌ 模擬數據指標：
- 手指數值固定或隨機跳躍
- EMG 數值固定在 431 ± 隨機值
- 串口顯示 "未連接" 或 "使用模擬數據"
- 數據缺乏人體動作的自然特徵
```

---

## 🔧 故障排除

### 常見問題與解決方案

**問題1：所有手指數據都是0或1023**
```
原因：電位器接線錯誤或電源問題
解決：檢查 3.3V 和 GND 連接，確認電位器中心抽頭接到正確的模擬引腳
```

**問題2：數據不更新或更新很慢**
```
原因：串口波特率不匹配
解決：確認 Arduino 代碼中 Serial.begin(9600) 與網頁端波特率一致
```

**問題3：IMU 數據全為0**
```
原因：IMU 初始化失敗
解決：檢查 Arduino 庫安裝，確認使用 Arduino Nano 33 BLE Sense Rev2
```

**問題4：無法連接設備**
```
原因：瀏覽器不支援 Web Serial API
解決：使用 Chrome 89+ 或 Edge 89+ 瀏覽器
```
